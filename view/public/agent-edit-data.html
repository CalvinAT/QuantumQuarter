<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Quantum Quarter | Agent Edit Data</title>
    <link rel="stylesheet" href="./output.css">
    <link rel="icon" type="image/png" href="./asset/qq-icon.png">
    <script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
    </script>
    <script>
        $(function(){
            $("#footer").load("footeraa.html"); 
        });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    
  </head>
  <body class="bg-qq-primary font-inter text-qq-secondary">
    <div class="flex flex-row bg-qq-secondary py-[3%] items-center">
        <image src="./asset/qq-logo.png" class="pl-[2%]"></image>
        <p class="text-white text-5xl pl-[2.3%] font-playfair">Agent | Edit Data</p>
        <div class="ml-auto pr-[4%] flex items-center">
            <a href="agent-main.html"><image src="./asset/prev.png" class="pl-[2%]"></image></a>
        </div>
    </div>
    <div class="mx-[26%]">
        <div class="mt-[5%] py-[2%] bg-qq-secondary align-middle">
            <div class="flex text-qq-primary font-semibold">
                <div class="w-[20%] text-2xl text-center">Edit Data</div>
            </div>
        </div>
        <div class="shadow-xl">
            <div id="edit-data">
            </div>
            <div class=" py-[2%] align-middle flex text-qq-secondary">
                <div id="submit" class="hover:cursor-pointer bg-qq-secondary w-36 h-9 ml-auto mr-7 mt-5 text-center text-qq-primary pt-2">
                    Confirm
                </div>
            </div>
            <div class="border-2 border-black opacity-30"></div>
        </div>
        
    </div>
    <div id="footer"></div>
    <script>
            const token = localStorage.getItem("authToken");
            const queryString = window.location.search.substring(1);
            const queryParameter = queryString.split('&');
            const parts = queryParameter[0].split('=');
            const agentId = decodeURIComponent(parts[1]);

            fetch('http://localhost:3000/getemployee', {
                method: 'POST',
                headers: {
                    'authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const agent = data.data[0]
                const myDiv = document.getElementById('edit-data');
                let htmlCode = '';
                htmlCode += `
                <div class=" py-[2%] mt-[3%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Profile Picture</div>
                        <p class="w-[40%] text-2xl pl-[3%] flex rounded-l-xl h-60">
                            <image class="h-full" src="${agent.profile_path}"></image>
                        </p>
                    </div>
                    
                    <div class=" py-[2%] mt-[3%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Username</div>
                        <p class="w-[40%] text-2xl pl-[3%] flex rounded-l-xl">
                            ${agent.name}
                        </p>
                    </div>
                    
                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Telp</div>
                        <label class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <input id="telp" type="text" class="pl-3 rounded-md" value="${agent.phone_number}" min="0">
                        </label>
                    </div>

                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Whatsapp</div>
                        <label class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <input id="whatsapp" type="text" class="pl-3 rounded-md" value="${agent.whatsapp}" min="0">
                        </label>
                    </div>

                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Branch</div>
                        <p class="w-[40%] text-2xl pl-[3%] flex rounded-l-xl">
                            ${agent.branch_id}
                        </p>
                    </div>
                    
                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Address</div>
                        <label class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <input id="address" type="text" class="pl-3 rounded-md" value="${agent.address}" min="0">
                        </label>
                    </div>
                    
                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Gender</div>
                        <div class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <label class="flex bg-qq-primary">
                                <input type="radio" name="gender" value="Male" checked="checked">
                                <i class="pl-2 font-inter font-semibold">Male</i>
                            </label>
                    
                            <label class="pl-[12%] flex bg-qq-primary ">
                                <input type="radio" name="gender" value="Female" disabled>
                                <i class="pl-2 font-inter font-semibold">Female</i>
                            </label>
                        </div>
                    </div>

                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Email</div>
                        <label class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <input id="email" type="text" class="pl-3 rounded-md" value="${agent.email}" min="0">
                        </label>
                    </div>

                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">Current Password</div>
                        <label class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <input id="currpassword" type="password" class="pl-3 rounded-md" value="" min="0">
                        </label>
                    </div>

                    <div class=" py-[2%] align-middle flex text-qq-secondary">
                        <div class="w-[30%] text-2xl pl-[6%]">New Password</div>
                        <label class="w-[40%] text-2xl pl-[3%] flex bg-qq-primary text-gray-700 rounded-l-xl">
                            <input id="newpassword" type="password" class="pl-3 rounded-md" min="0">
                        </label>
                    </div>
                `
                console.log(htmlCode)
                myDiv.innerHTML = htmlCode
        })
        .catch(error => {
                // Handle any errors
                console.error('Error:', error);
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const agentLink = document.querySelector('a[href="agent-main.html"]');
            // Cek apakah elemen anchor tersebut ditemukan
            if (agentLink) {
                // Tambahkan query parameters ke href
                agentLink.href += `?agentId=${agentId}`;
            }
            document.getElementById('submit').addEventListener('click', function () {
                alert('masuk sini')
              const telp = document.getElementById("telp").value;
              const whatsapp = document.getElementById('whatsapp').value;
              const address = document.getElementById('address').value;
              const email = document.getElementById('email').value;
              const password = document.getElementById('currpassword').value;
              const newPassword = document.getElementById('newpassword').value;
    
              const formData = new FormData();
              formData.append('phoneNumber', telp)
              formData.append('whatsapp', whatsapp)
              formData.append('address', address)
              formData.append('email', email)
              formData.append('password', password)
              formData.append('newPassword', newPassword)
              
              fetch('http://localhost:3000/agent', {
                method: 'PUT',
                headers: {
                    'authorization': `Bearer ${token}`
                },
                body: formData
              })
              .then(response => response.json())
              .then(data => {
                if(data.status == '201') {
                    alert("Profil berhasil diupdate")
                }
              })
            })
        })
      </script>
  </body>
</html>